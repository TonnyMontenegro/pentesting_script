#!/bin/bash

#Define la ruta de ETC_HOSTS
ETC_HOSTS=/etc/hosts

echo -e "\e[1;37m Bienvenido a $0 de \e[1;35mpentesting\e[1;37m, se procedera a verificar que tenga \e[1;36mDocker\e[1;37m instalado y ejecutandose:\e[0m"
echo
echo -e "\e[1;37m-------------------------------------------------------------------------------------------------------------"
### Comprueba si docker esta instalado,en caso contrario lo instala ###
if ! [ -x "$(command -v docker)" ]; then
  echo -e  
  echo -e  "\e[1;33m No se econtro \e[1;36mdocker\e[1;33m instalado, se procede a instalarlo"
    if fuser /var/lib/dpkg/lock > /dev/null 2>&1 
    then 
            echo -e  "\e[1;31m Ya se encuentra otro proceso de instalacion, espere a que termine para continuar \e[0m"
            exit
    fi
    echo -e  "\e[1;34m$ Actualizando el sistema \e[0m"
    sudo apt-get update

    # Instala las dependencias
    sudo apt-get install \
        apt-transport-https \
        ca-certificates \
        curl \
        gnupg-agent \
        software-properties-common

    # Añade la gpg key de docker
    curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -

    if grep -q download.docker.com /etc/apt/sources.lista; then
    echo -e  "\e[1;32msources.lista ya contiene \e[1;36mdownload.docker.com\e[0m"
    else
    echo -e  "\e[1;32mAñadiendo \e[1;36mdownload.docker.com\e[1;32m a sources.lista\e[0m"
    echo -e  "deb [arch=amd64] https://download.docker.com/linux/debian buster stable" | sudo tee --append /etc/apt/sources.lista > /dev/null

    fi

    echo -e  "\e[1;32mActualizando el sistema\e[0m"
    sudo apt-get update

    echo -e  "\e[1;32mInstalando \e[1;36mdocker\e[0m"
    sudo apt-get install docker-ce docker-ce-cli containerd.io

    echo -e  "\e[1;32mHabilitando auto inicio de \e[1;36mdocker\e[0m"
    sudo systemctl enable docker

else

  echo -e  "\e[1;36mDocker\e[1;32m ya esta instalado en el sistema. \e[0m" 

fi

echo
echo


### Comprueba si el servicio de docker esta activo y lo inicia ###
if sudo service docker status | grep inactive > /dev/null
then 
	echo -e  "\e[1;31mERROR: \e[1;36mDocker\e[1;31m no esta corriendo.\e[0m"
	echo -e  "\e[1;33mDesea iniciarlo? (s/n)\e[0m"
	read respuesta
	if echo -e  "$respuesta" | grep -iq "^s"; then
        echo -e  "\e[1;32mIniciando \e[1;36mdocker\e[0m"
		sudo service docker start
	else
        echo -e  "\e[1;31mNo iniciando. No se puede ejcutar el script sin \e[1;36mdocker.\e[0m"
	fi
else

  echo -e  "\e[1;36mDocker\e[1;32m  ya esta corriendo. \e[0m"

fi

echo
echo

### lista las applicaciones vunerables que se pueden usar para nuestro lab ###
lista() {
    echo -e  "\e[1;36mlistado de aplicaciones vulnerables para pentesting\e[0m"
    echo -e  "  bwapp 		              - bWAPP PHP/MySQL basada en itsecgames.com"
    echo -e  "  webgoat7		            - WebGoat 7.1 OWASP Flagship Project"
    echo -e  "  webgoat8		            - WebGoat 8.0 OWASP Flagship Project"
    echo -e  "  nodegoat		            - NodeGoat OWASP Project"
    echo -e  "  dvwa     		            - Damn Vulnerable Web Application"
    echo -e  "  mutillidae		          - OWASP Mutillidae II"
    echo -e  "  juiceshop		            - OWASP Juice Shop"
    echo -e  "  vulnerablewordpress	    - WPScan Vulnerable Wordpress"
    echo -e  "  securityninjas	        - OpenDNS Security Ninjas"
    echo -e 
    exit 1

}

info() {
  case "$1" in 
    bwapp)
      project_info_bwapp
      ;;
    webgoat7)
      project_info_webgoat7
      ;;
    webgoat8)
      project_info_webgoat8      
      ;;
    nodegoat)
      project_info_nodegoat      
      ;;
    dvwa)
      project_info_dvwa 
      ;;
    mutillidae)
      project_info_mutillidae
    ;;
    juiceshop)
      project_info_juiceshop
    ;;
    vulnerablewordpress)
      project_info_vulnerablewordpress
    ;;
    securityninjas)
      project_info_securityninjas
    ;;
    *) 
      echo -e  "\e[1;31mError: $1 no es una opcion valida.\e[0m"
      lista
      ;;
  esac  
}

# Basado en https://gist.github.com/irazasyed/a7b0a079e7727a4315b9
function removehost() {
    if [ -n "$(grep $1 /etc/hosts)" ]
    then
        echo -e  "\e[1;31mEliminando $1 from $ETC_HOSTS";
        sudo sed -i".bak" "/$1/d" $ETC_HOSTS
    else
        echo -e "\e[1;31m$1 no fue encontrado en $ETC_HOSTS";
    fi
}

function addhost() { # ex. 127.5.0.1 bwapp
    HOSTS_LINE="$1\t$2"
    if [ -n "$(grep $2 /etc/hosts)" ]
        then
            echo -e "\e[1;31m$2 ya existe en /etc/hosts"
        else
            echo -e "\e[1;32mAñadiendo $2 en $ETC_HOSTS";
            sudo -- sh -c -e "echo '$HOSTS_LINE' >> /etc/hosts";

            if [ -n "$(grep $2 /etc/hosts)" ]
                then
                    echo -e "\e[1;32m$HOSTS_LINE fue añadido con exito a /etc/hosts";
                else
                    echo -e  "\e[1;31mError: no se pudo añadir $2, Vuelvalo a intentar!";
            fi
    fi
}


ayuda() {
    echo -e "Uso: \e[1;35m$0 {lista|estado|info|iniciar|detener} [NombreDelProyecto]\e[1;37m"
    echo
    echo -e "Este script usa docker y los alias de host para hacer disponible de manera local las apps vulnerables"
    echo
    echo
    echo
    echo -e "Ejemplos..."
    echo -e "\e[1;34m$ $0 lista\e[37m"
    echo -e "\e[1;mMuestra la lista de proyectos disponibles"
    echo
    echo -e  "\e[1;34m$ $0 estado\e[37m"
    echo -e  "\e[1;mMuestra el estado de cada uno de los proyectos"
    echo
    echo -e  "\e[1;34m$ $0 iniciar bwapp\e[37m"
    echo -e  "\e[1;mInicia la descarga de la imagen y la configuracion para hacerla disponible de manera local" 
    echo
    echo -e  "\e[1;34m$ $0 info bwapp\e[37m"
    echo -e  "\e[1;mMuestra la informacion detallada de dicho proyecto"
    echo
    echo
    echo
    echo -e  " Fuentes de los \e[1;36mdockers\e[0m\e[1;37m"
    echo -e  "  bwapp                   - bWAPP PHP/MySQL basada en itsecgames.com \e[1;35mpor Rory McCune (raesene/bwapp)\e[1;37m"
    echo -e  "  webgoat7                - WebGoat 7.1 OWASP Flagship Project por OWASP Project\e[1;37m\e[1;37m"
    echo -e  "  webgoat8                - WebGoat 8.0 OWASP Flagship Project \e[1;35mpor OWASP Project\e[1;37m"
    echo -e  "  nodegoat                - NodeGoat OWASP Project \e[1;35mpor Ben McMahon (bjm243/nodegoat)\e[1;37m"
    echo -e  "  dvwa                    - Damn Vulnerable Web Application \e[1;35mpor Ryan Dewhurst (vulnerables/web-dvwa)\e[1;37m"
    echo -e  "  mutillidae              - OWASP Mutillidae II \e[1;35mpor Nikolay Golub (citizenstig/nowasp)\e[1;37m"
    echo -e  "  juiceshop               - OWASP Juice Shop \e[1;35mpor Bjoern Kimminich (bkimminich/juice-shop)\e[1;37m"
    echo -e  "  vulnerablewordpress     - WPScan Vulnerable Wordpress \e[1;35mpor WPScan Team (l505/vulnerablewordpress)\e[1;37m"
    echo -e  "  securityninjas          - OpenDNS Security Ninjas \e[1;35mpor OpenDNS Security Ninjas AppSec Training\e[1;37m"
    echo
    exit 1
}


########################################################### BWAPP ###########################################################

project_info_bwapp () 
{
echo " bWAPP o  buggy web application, es una aplicación web gratuita y de código abierto deliberadamente insegura."
echo " Ayuda a los entusiastas de la seguridad, desarrolladores y estudiantes a descubrir y prevenir vulnerabilidades web."
echo " bWAPP te prepara para realizar pruebas de penetración exitosas y proyectos de hacking ético."
echo 
echo " ¿Qué hace que bWAPP sea tan único? Bueno dejame te  explico, ¡tiene más de 100 VULNERABILIDADES web!!!"
echo " Cubre todos los principales errores web conocidos, incluidos todos los riesgos del proyecto OWASP Top 10."
echo
echo " bWAPP es una aplicación PHP que utiliza una base de datos MySQL. Se puede alojar en Linux/Windows "
echo " con Apache/IIS y MySQL. También se puede instalar con WAMP o XAMPP."
echo " otra posibilidad es descargar bee-box, una máquina virtual Linux personalizada preinstalada con bWAPP."
echo
echo "bWAPP es una web app para testeo de seguridad y fines educativos unicamente ;)"
echo "Diviertete con este projecto de software libre!"
echo
echo -e "\e[1;34mlink:   http://www.itsecgames.com/\e[1;37m"
echo
echo "TECH: 	PHP / MySQL"
echo "FEATURES: Diferentes niveles de dificultad para el desarrollo de pruebas de penetración"
}

iniciar_systeminfo_bwapp () 
{
  echo "Recuerda ejecutar install.php antes de usar bwapp por primera vez."
  echo -e "en: \e[1;34mhttp://bwapp/install.php\e[1;37m"
  echo "por defecto usuario/contraseña:  bee/bug"
  echo -e "bWAPP ahora esta disponible en \e[1;34mhttp://bwapp\e[1;37m"
}

############################################################################################################################

########################################################### WebGoat ###########################################################

project_info_webgoat7 () 
{
echo "WebGoat es una aplicación web deliberadamente insegura mantenida por OWASP diseñada para enseñar"
echo "Lecciones de seguridad de aplicaciones web. Puedes instalar y practicar con WebGoat."
echo "La comprensión de un problema de seguridad mediante la explotación de una vulnerabilidad real en la"
echo "Aplicacione WebGoat. Por ejemplo, en una de las lecciones el usuario debe usar inyección SQL"
echo "para robar números de tarjetas de crédito falsos. La aplicación tiene como objetivo proporcionar una enseñanza realista."
echo " entorno, que proporciona a los usuarios sugerencias y código para explicar mejor la lección"
echo
echo "¿Por qué el nombre WebGoat? Los desarrolladores no deben sentirse mal por no conocer la seguridad. Incluso los mejores programadores"
echo "cometen errores de seguridad. Lo que necesitan es un chivo expiatorio, ¿verdad? ¡Solo échale la culpa a la Cabra!"
echo
echo -e "\e[1;34mlink:  https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project\e[1;37m"
echo
echo "TECH: 	J2EE JAVA"
echo "FEATURES: Lecciones de aprendizaje"
}

iniciar_systeminfo_webgoat7 () 
{
  echo -e "WebGoat 7.1 ahora esta disponible en: \e[1;34mhttp://webgoat7/WebGoat\e[1;37m"
}

project_info_webgoat8 () 
{
echo "WebGoat es una aplicación web deliberadamente insegura mantenida por OWASP diseñada para enseñar"
echo "Lecciones de seguridad de aplicaciones web. Puedes instalar y practicar con WebGoat."
echo "La comprensión de un problema de seguridad mediante la explotación de una vulnerabilidad real en la"
echo "Aplicacione WebGoat. Por ejemplo, en una de las lecciones el usuario debe usar inyección SQL"
echo "para robar números de tarjetas de crédito falsos. La aplicación tiene como objetivo proporcionar una enseñanza realista."
echo " entorno, que proporciona a los usuarios sugerencias y código para explicar mejor la lección"
echo
echo "¿Por qué el nombre WebGoat? Los desarrolladores no deben sentirse mal por no conocer la seguridad. Incluso los mejores programadores"
echo "cometen errores de seguridad. Lo que necesitan es un chivo expiatorio, ¿verdad? ¡Solo échale la culpa a la Cabra!"
echo
echo -e "\e[1;34mlink:  https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project\e[1;37m"
echo
echo "TECH: 	J2EE JAVA"
echo "FEATURES: Lecciones de aprendizaje"
}

iniciar_systeminfo_webgoat8 () 
{
  echo -e "WebGoat 8.0 ahora esta disponible en: \e[1;34mhttp://webgoat8/WebGoat\e[1;37m"
}

############################################################################################################################

########################################################### NodeGoat #######################################################

project_info_nodegoat () 
{
echo "NodeGoat es una aplicación web deliberadamente insegura mantenida por OWASP diseñada para enseñar"
echo "lecciones de seguridad de aplicaciones web. Puedes instalar y practicar con NodeGoat."
echo "Hay otras cabras como NodeGoat para Node.js. En cada lección, los usuarios deben demostrar"
echo "su comprensión de un problema de seguridad mediante la explotación de una vulnerabilidad real en la"
echo "Aplicacion de NodeGoat. Por ejemplo, en una de las lecciones el usuario debe usar inyecciones de javascript"
echo "para robar números de tarjetas de crédito falsos. La aplicación tiene como objetivo proporcionar una enseñanza realista."
echo "en un entorno, que proporciona a los usuarios sugerencias y código para explicar mejor la lección"
echo
echo "¿Por qué el nombre NodeGoat? Los desarrolladores no deben sentirse mal por no conocer la seguridad. Incluso los mejores programadores"
echo "cometen errores de seguridad. Lo que necesitan es un chivo expiatorio, ¿verdad? ¡Solo échale la culpa a la Cabra!"
echo
echo -e "\e[1;34mlink:   https://wiki.owasp.org/index.php/Projects/OWASP_Node_js_Goat_Project\e[1;37m"
echo
echo "TECH: 	Node.js NoSQL"
echo "FEATURES: Lecciones de aprendizaje"
}

iniciar_systeminfo_nodegoat () 
{
  echo -e "NodeGoat 1.3 ahora disponible en: \e[1;34mhttp://nodegoat.net/login\e[1;37m"
  echo "Cuenta Demo - Usuario:demo Contraseña:demo"
  echo "También se pueden agregar nuevos usuarios mediante la página de registro."
}

############################################################################################################################

####################################################### DVWA ###############################################################

project_info_dvwa () 
{
echo "El objetivo de DVWA es practicar algunas de las vulnerabilidades web más comunes, con varios"
echo "niveles de dificultad, con una interfaz sencilla y directa. Tenga en cuenta que hay"
echo "vulnerabilidades documentadas y no documentadas con este software. Esto es intencional."
echo "Le recomendamos que intente descubrir tantos problemas como sea posible."
echo
echo -e "\e[1;34mlink:   https://www.dvwa.co.uk/\e[1;37m"
echo
echo "TECH: 	PHP / MySQL"
echo "FEATURES: Diferntes niveles de dificultad"
}

iniciar_systeminfo_dvwa () 
{
  echo -e "DVWA ahora disponible en: \e[1;34mhttp://dvwa\e[1;37m"
  echo "Por defecto Usuario/Contraseña:   admin/password"
  echo "Recuerda hacer click en el boton CREATE DATABASE antes de comenzar para asi crear la base de datos"
}
############################################################################################################################

####################################################### mutillidae ##########################################################
project_info_mutillidae ()
{
echo "NOWASP (Mutillidae) es una aplicación web gratuita, de código abierto y deliberadamente vulnerable"
echo "proporcionando un objetivo para los entusiastas de la seguridad web".
echo "Proyecto Incubado por OWASP."
echo
echo "TECH: PHP / MySQL"
echo "FEATURES: differntes niveles de dificultad"
}

iniciar_systeminfo_mutillidae ()
{
   echo -e "OWASP Mutillidae II ahora disponible en: \e[1;34mhttp://mutillidae\e[1;37m"
   echo "Recuerde hacer clic en el enlace create database antes de comenzar"
}
############################################################################################################################

####################################################### JuiceShop ###########################################################
project_info_juiceshop ()
{
echo "OWASP Juice Shop es una aplicación web intencionalmente insegura escrita completamente en JavaScript"
echo "que abarca toda la gama de OWASP Top Ten y otras graves fallas de seguridad".
echo -e "\e[1;34mlink: https://github.com/bkimminich/juice-shop\e[1;37m"
echo
echo "TECH: Javascript"
echo "FEATURES: web moderna con vulneraborabilidades frecuentes"
}

iniciar_systeminfo_juiceshop ()
{
   echo -e "juiceshop OWASP ya está disponible en: \e[1;34mhttp://juiceshop\e[1;37m"
}
############################################################################################################################

####################################################### securitysheperd ###############################################################
project_info_securitysheperd  ()
{
echo "El proyecto OWASP securitysheperd es una plataforma de capacitación en seguridad de aplicaciones web y móviles. "
echo "securitysheperd  ha sido diseñado para fomentar y mejorar la conciencia de seguridad entre una variedad"
echo "demografíca de habilidades. El objetivo de este proyecto es tomar AppSec principiantes o experimentados"
echo "ingenieros y perfeccionar su conjunto de habilidades de pruebas de penetración al estado de experto en seguridad".
echo -e "\e[1;34mlink: https://www.owasp.org/index.php/OWASP_Security_Shepherd\e[1;37m"
echo
echo "FEATURES: Diferentes niveles de dificultad"
}

iniciar_systeminfo_seguridadsheperd ()
{
   echo -e "OWASP securitysheperd ahora disponible en: \e[1;34mhttp://securitysheperd\e[1;37m"
}
############################################################################################################################

####################################################### vulnerablewordpress ###############################################################
project_info_vulnerablewordpress () 
{
echo "Aplicación WordPress Vulnerable"
echo
echo -e "\e[1;34mlink: https://github.com/wpscanteam/VulnerableWordpress\e[1;37m"
echo
echo "TECNOLOGÍA: PHP / MySQL"
echo "CARACTERÍSTICAS: "
}

iniciar_systeminfo_vulnerablewordpress ()
{
   echo -e "El sitio de WordPress vulnerable de WPScan ahora está disponible en localhost en: \e[1;34mhttp://vulnerablewordpress\e[1;37m"
}
############################################################################################################################

####################################################### securityninja ###########################################################
project_info_securityninjas () 
{
echo "Este laboratorio de capacitación práctica consta de 10 divertidos ejercicios de piratería del mundo real,"
echo "correspondientes a cada una de las 10 vulnerabilidades principales de OWASP. Se proporcionan sugerencias y" 
echo "soluciones a lo largo del camino. Aunque el backend para esto está escrito en PHP, las vulnerabilidades seguirán"
echo "siendo las mismas en todos los lenguajes basados en la web, por lo que la capacitación seguirá siendo relevante "
echo "incluso si no codifica activamente en PHP."
echo
echo -e "\e[1;34mlink: https://github.com/opendns/Security_Ninjas_AppSec_Training\e[1;37m"
echo
echo "TECH: PHP / MySQL"
echo "FEATURES: Lecciones de aprendizaje, tips y solucion"
}

iniciar_systeminfo_securityninjas ()
{
  echo -e "Security Ninjas ahora esta disponible en: \e[1;34mhttp://securityninjas\e[1;37m"
}
#################################################################################################################################


iniciar_system ()
{
  fullname=$1		# ex. WebGoat 7.1
  projectname=$2     	# ex. webgoat7
  dockername=$3  	# ex. raesene/bwapp
  ip=$4   		# ex. 127.5.0.1
  port=$5		# ex. 80
  port2=$6		# optional second port binding
  
  echo -e "\e[1;32mIniciando $fullname\e[1;37m"
  addhost "$ip" "$projectname"


  if [ "$(sudo docker ps -aq -f name=$projectname)" ]; 
  then
    echo -e "\e[1;36mRunning command: docker start $projectname\e[1;37m"
    sudo docker start $projectname
  else
    if [ -n "${6+set}" ]; then
      echo -e "\e[1;36mEjecutando: docker run --name $projectname -d -p $ip:80:$port -p $ip:$port2:$port2 $dockername\e[1;37m"
      sudo docker run --name $projectname -d -p $ip:80:$port -p $ip:$port2:$port2 $dockername
    else echo -e "\e[1;31mNo se pudo establecer en este puerto, probando en otro...\e[1;37m";
      echo -e "\e[1;36mEjecutando: docker run --name $projectname -d -p $ip:80:$port $dockername\e[1;37m"
      sudo docker run --name $projectname -d -p $ip:80:$port $dockername
    fi
  fi
  echo -e "\e[1;32mFINALIZADO!\e[1;37m"
  echo
  echo -e "\e[1;32mDocker vinculado a: \e[1;34mhttp://$projectname \e[1;32mo \e[1;34mhttp://$ip\e[1;37m"
  echo
}

project_detener ()
{
  fullname=$1	# ex. WebGoat 7.1
  projectname=$2     # ex. webgoat7

  echo -e "\e[1;31mDeteniendo... $fullname\e[1;37m"
  echo -e "\e[1;36mEjecutando: docker stop $projectname\e[1;37m"
  sudo docker stop $projectname
  removehost "$projectname"
  echo -e "\e[1;31mApplicacion detenida, ya no esta disponible en \e[1;34mhttp://$projectname\e[1;37m"
}


estado()
{
  if [ "$(sudo docker ps -q -f name=bwapp)" ]; then
    echo -e "\e[1;32mbWaPP				Ejecutandose en \e[1;34mhttp://bwapp\e[1;37m"
  else 
    echo -e "\e[1;31mbWaPP				Detenida\e[1;37m\e[1;37m"
  fi
  if [ "$(sudo docker ps -q -f name=webgoat7)" ]; then
    echo -e "\e[1;32mWebGoat 7.1			Ejecutandose en \e[1;34mhttp://webgoat7/WebGoat\e[1;37m"
  else 
    echo -e "\e[1;31mWebGoat 7.1			Detenida\e[1;37m"  
  fi
  if [ "$(sudo docker ps -q -f name=webgoat8)" ]; then
    echo -e "\e[1;32mWebGoat 8.0			Ejecutandose en \e[1;34mhttp://webgoat8/WebGoat\e[1;37m"
  else 
    echo -e "\e[1;31mWebGoat 8.0			Detenida"  
  fi
  if [ "$(sudo docker ps -q -f name=nodegoat)" ]; then
    echo -e "\e[1;32mNodeGoat 1.3			Ejecutandose en \e[1;34mhttp://nodegoat.net/login\e[1;37m"
  else 
    echo -e "\e[1;31mNodeGoat 1.3			Detenida\e[1;37m" 
  fi
  if [ "$(sudo docker ps -q -f name=dvwa)" ]; then
    echo -e "\e[1;32mDVWA				Ejecutandose en \e[1;34mhttp://dvwa\e[1;37m"
  else 
    echo -e "\e[1;31mDVWA				Detenida\e[1;37m"
  fi
  if [ "$(sudo docker ps -q -f name=mutillidae)" ]; then
    echo -e "\e[1;32mMutillidae II			Ejecutandose en \e[1;34mhttp://mutillidae\e[1;37m"
  else 
    echo -e "\e[1;31mMutillidae II			Detenida\e[1;37m"
  fi
  if [ "$(sudo docker ps -q -f name=juiceshop)" ]; then
    echo -e "\e[1;32mOWASP Juice Shop 		Ejecutandose en \e[1;34mhttp://juiceshop\e[1;37m"
  else 
    echo -e "\e[1;31mOWASP Juice Shop 		Detenida\e[1;37m"  
  fi
  if [ "$(sudo docker ps -q -f name=vulnerablewordpress)" ]; then
    echo -e "\e[1;32mWPScan Vulnerable Wordpress 	Ejecutandose en \e[1;34mhttp://vulnerablewordpress\e[1;37m"
  else 
    echo -e "\e[1;31mWPScan Vulnerable Wordpress	Detenida\e[1;37m"
  fi
  if [ "$(sudo docker ps -q -f name=securityninjas)" ]; then
    echo -e "\e[1;32mOpenDNS Security Ninjas 	Ejecutandose en \e[1;34mhttp://securityninjas\e[1;37m"
  else 
    echo -e "\e[1;31mOpenDNS Security Ninjas 	Detenida\e[1;37m"
  fi
}

start_system()
{
  if [ "$(sudo docker ps -q -f name=$1)" ]; then
    echo -e "\e[1;31m$1	esta activa, no se puede volver a iniciar\e[1;37m"
    echo -e "\e[1;36mPuedes ver $1	en: \e[1;34mhttp://$1\e[1;37m"
  else
    case "$1" in
      bwapp)
        iniciar_system "bWAPP" "bwapp" "raesene/bwapp" "127.10.0.1" "80"
        iniciar_systeminfo_bwapp
      ;;
      webgoat7)
        iniciar_system "WebGoat 7.1" "webgoat7" "webgoat/webgoat-7.1" "127.11.0.1" "8080"
        iniciar_systeminfo_webgoat7
      ;;
      webgoat8)
        iniciar_system "WebGoat 8.0" "webgoat8" "webgoat/webgoat-8.0" "127.12.0.1" "8080"
        iniciar_systeminfo_webgoat8
      ;;
      nodegoat)
        iniciar_system "NodeGoat 1.3" "nodegoat" "bjm243/nodegoat" "127.13.0.1" "4000"
        iniciar_systeminfo_nodegoat
      ;;
      dvwa)
        iniciar_system "Damn Vulnerable Web Appliaction" "dvwa" "vulnerables/web-dvwa" "127.14.0.1" "80"
        iniciar_systeminfo_dvwa
      ;;    
      mutillidae)
        iniciar_system "Mutillidae II" "mutillidae" "citizenstig/nowasp" "127.15.0.1" "80"
        iniciar_systeminfo_mutillidae
      ;;
      juiceshop)
        iniciar_system "OWASP Juice Shop" "juiceshop" "bkimminich/juice-shop" "127.16.0.1" "3000"
        iniciar_systeminfo_juiceshop
      ;;
      securitysheperd)
        iniciar_system "OWASP Security Shepard" "securitysheperd" "ismisepaul/securityshepherd" "127.17.0.1" "80"
        iniciar_systeminfo_securitysheperd
      ;;
      vulnerablewordpress)
        iniciar_system "WPScan Vulnerable Wordpress" "vulnerablewordpress" "l505/vulnerablewordpress" "127.18.0.1" "80" "3306"
        iniciar_systeminfo_vulnerablewordpress
      ;;
      securityninjas)    
        iniciar_system "Open DNS Security Ninjas" "securityninjas" "opendns/security-ninjas" "127.19.0.1" "80"
        iniciar_systeminfo_securityninjas
      ;;
      *)
      echo -e "\e[1;31mERROR: No se reconoce el proyecto $1, no se pudo inicializar, prueba a iniciar alguno de los siguientes proyectos:\e[1;37m"
      lista
      ;;
    esac
  fi
}


detener_system()
{
  if [ "$(sudo docker ps -q -f name=$1)" ]; then
    echo -e "\e[1;32m$1	esta activa, se procede a detenerla\e[1;37m"
    case "$1" in
      bwapp)
        project_detener "bWAPP" "bwapp"
      ;;
      webgoat7)
        project_detener "WebGoat 7.1" "webgoat7"
      ;;
      webgoat8)
        project_detener "WebGoat 8.0" "webgoat8"
      ;;
      nodegoat)
        project_detener "NodeGoat 1.3" "nodegoat"
      ;;
      dvwa)
        project_detener "Damn Vulnerable Web Appliaction" "dvwa"
      ;;
      mutillidae)
        project_detener "Mutillidae II" "mutillidae"
      ;;
      juiceshop)
        project_detener "OWASP Juice Shop" "juiceshop"
      ;;
      securitysheperd)
        project_detener "OWASP Security Sheperd" "securitysheperd"
      ;;
      vulnerablewordpress)
        project_detener "WPScan Vulnerable Wordpress" "vulnerablewordpress"
      ;;
      securityninjas)
        project_detener "Open DNS Security Ninjas" "securityninjas"
      ;;
      *)
      echo -e "\e[1;31mERROR: No se reconoce el proyecto $1, no se pudo detener\e[1;37m"
      ;;
    esac
  else 
    echo -e "\e[1;31m$1 ya esta inactiva o aun no se ha creado, puedes probar a iniciar alguno de estos proyectos:\e[1;37m"
    lista    
  fi
}

case "$1" in
  iniciar)
    if [ -z "$2" ]
    then
      echo -e "\e[1;31mERROR: la opción iniciar requiere un parámetro en minusculas\e[1;37m"
      echo 
      lista
      break
    fi
    start_system $2
    ;;
  detener)
    if [ -z "$2" ]
    then
      echo -e "\e[1;31mERROR: la opción detener requiere un parámetro en minusculas\e[1;37m"
      echo 
      lista
      break
    fi
    detener_system $2
    ;;
  lista)
    lista
    ;;
  estado)
    estado
    ;;
  info)
    if [ -z "$2" ]
    then
      echo -e "\e[1;31mERROR: la opción info requiere un parámetro en minusculas\e[1;37m"
      echo 
      lista
      break
    fi
    info $2
    ;;
  *)
    ayuda
;;
esac  
